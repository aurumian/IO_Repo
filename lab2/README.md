# Лабораторная работа 2

**Название:** "Разработка драйверов блочных устройств"

**Цель работы:** Получить знания и навыки разработки драйверов блочных устройств для операционной системы Linux. 

**Выполнили:** Черезов Юрий Юрьевич PЗ400, Черезов Игорь Юрьевич P3400

## Описание функциональности драйвера

Драйвер создает:
* Первичный раздел размером 10 Мбайт
* Расширенный раздел, содержащий два логических раздела по 20 Мбайт

## Инструкция по сборке

1. Соберите программу: `make`
2. Добавляем драйвер в ядро. В директории `/dev` будет 5 девайсов mydisk, mydisk1, mydisk2, mydisk5, mydisk6:
    > insmod lab2.ko
3. Создаем файловые системы на девайсах: 
    > mkfs.vfat -F16 /dev/mydisk1 && mkfs.vfat -F16 /dev/mydisk5
4. Монтируем их в точки монтирования: 
    > mkdir -p /mnt/mydisk1 /mnt/mydisk5 && mount /dev/mydisk1 /mnt/mydisk1 && mount /dev/mydisk5 /mnt/mydisk5

## Примеры использования

Проверка точки монтирования
```bash
$ mount -l | grep "/dev/mydisk"
```

Размонтирование файловых систем и деинициализация драйвера:
```bash
$ umount /dev/mydisk1 && umount /dev/mydisk5
$ rmmod lab2
```

Проверка сообщений в кольцевом буфере
```bash
$ cd /mnt/mydisk1
$ touch example
$ dmesg
...

```

Создание файлов на виртуальном устройстве
```bash
$ cd /mnt/mydisk1
$ echo "Hello block device" > ./hello
```

## Профилирование скорости копирования

Измерение скорости передачи данных при копировании файлов между разделами виртуального диска
```bash
$ fallocate -l 7340032 /mnt/var5p1/example.txt              # создание файла 7Мбайт
$ pv -pr /mnt/mydisk1/file.txt > /mnt/mydisk5/file.txt  # копирование файла из виртуального раздела 1 в логический виртуальный раздел 5
```

Измерение скорости передачи данных при копировании файлов между разделами виртуального диска
```bash
$ fallocate -l 7340032 /mnt/example.txt              # создание файла 7Мбайт
$ pv -pr /mnt/file.txt > /mnt/mydisk1/file.txt  # копирование файла из реального диска в виртуальный диск
```

размер (Mbyte) | количество тестов | с реального на виртуальный (Mbit/s) | с виртуального на виртуальный (Mbit/s)
-------------- | ----------------- | ----------------------------------- | --------------------------------------
7 | 10 | 373 | 431
5 | 10 | 308 | 416
3 | 10 | 452 | 507

